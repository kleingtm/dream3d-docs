 EMsoftgetEBSDPatterns {#emsoftgetebsdpatterns}
=============

## Group (Subgroup) ##
EMsoftToolbox (EMsoftToolbox)

## Description ##
The EMsoftgetEBSDPatterns filter provides a direct interface to the EMsoft EBSD pattern simulation routine.  The routine requires both a Monte Carlo and an EBSD master pattern file as input, along with a series of detector geometry and settings parameters.  A list of quaternions is needed as input object (this can be generated, for instance, with the EMsoftSO3Sampler routine along with a conversion to quaternions; alternatively, one can take any list of quaternions generated by a DREAM3D filter and pass it on to this filter), and an array with simulated EBSD patterns is created, which can subsequently be written to a .dream3d file.

For a full explanation of the EBSD forward model we refer the user to the following paper: P.G. Callahan and M. De Graef, "*Dynamical EBSD Patterns Part I: Pattern Simulations*," Microscopy and Microanalysis, vol. **19**, pp. 1255-1265 (2013).

###Detector geometry###
The realism and accuracy of simulated EBSD patterns depends very strongly on the accuracy with which the detector parameters are known.  This is in particular true when one attempts to measure local strains using EBSPs, but it is also true if one wishes to use the dictionary indexing approach on an experimental data set.  Determining optimal detector parameters can be done using the EMsoftEBSDDetectorFit filter, which is currently under development.  The geometrical parameters provided by the manufacturer are usually a reasonable starting point for the fit filter, but the user should be aware of the remarks below.

###Scintillator vs. CCD camera###
The forward model performs a pattern computation on the surface of the scintillator,  ***not on the CCD camera***. The reason for this is simple: each vendor uses a scintillator, but the optics between the scintillator and the CCD are camera dependent (fiber bundle, lens, etc.).  Therefore, the pixel edge length on the scintillator (see table below) refers to the edge length of the projection of a CCD pixel onto the scintillator; it is not necessarily equal to the pixel size on the CCD camera (except for the unlikely situation where the magnification factor of the camera optics is precisely equal to 1).

###Pattern center remarks###
Every vendor uses a different reference frame to define the pattern center, and EMsoft has its own internal convention.  The simulated pattern is a rectangle of (Numsx, Numsy) pixels, corresponding to a rectangle of true dimensions Delta * (Numsx, Numsy) [microns] on the scintillator surface (see previous comment).  The center of the rectangle is taken to be the origin of the detector reference frame, so that the coordinates (in units of Delta) of a pixel lie in the intervals [-Numsx/2, Numsx/2] and [-Numsy/2, Numsy/2].  The pattern center coordinates (Xpc, Ypc) are measured in this reference frame, also in units of Delta.  The detector reference frame has its x-axis oriented horizontally, in the direction opposite to the sample's TD axis.  The detector y-axis points upwards towards the top of the microscope and lies in the plane formed by the sample RD and ND directions (assuming no sample Omega tilt around RD).  The detector z-axis then completes a right handed reference frame and points towards the sample, also in the RD-ND plane.

###Pattern orientation###
The simulated patterns are oriented such that their (0,0) pixel lies in the lower left portion of the scintillator; in other words, the pattern is arranged in the orientation that corresponds to looking at the scintillator from the sample vantage point.  When looking at simulated patterns in the free HDF Viewer program, one should be aware that arrays are displayed as images with the (0,0) pixel in the upper left corner, i.e., upside down from the actual orientation of the pattern on the scintillator.

###Detector parameter fit###
The detector parameters can be refined using a separate EMsoft program (more information to follow).

## Parameters ##
| Name | Type | Default Value | Description |
|------|------|------|------|
| Numsx | int | 640 | Number of pattern pixels along x |
| Numsy | int | 480 | Number of pattern pixels along y |
| L | float | 20000. | Distance from scintillator to beam incidence point [microns] |
| Thetac | float | 10. | Downward tilt angle of detector [degrees] |
| Delta | float | 150. | Pixel edge length on scintillator surface [microns] |
| Omega | float | 0. | Sample rotation angle around RD [degrees] |
| Xpc | float | 0. | Pattern center x-coordinate [pixels] |
| Ypc | float | 0. | Pattern center y-coordinate [pixels] |
| Beamcurrent | float | 1000. | Beam current [nA] |
| Dwelltime | float | 500. | Beam dwell time per pattern [micro s] |


## Required Geometry ##

Not Applicable

## Required Objects ##

An array of N input quaternions.

## Created Objects ##

This filter creates an array of simulated EBSD patterns. The output array dimensions are Numsx x Numsy x N, where N is the number of input quaternions.

## License & Copyright ##

Please see the description file distributed with this plugin.

## Funding Acknowledgment ##

This filter was developed with financial support from contract AFRL FA8650-10-D-5210, Task Order 0034.

## DREAM3D Mailing Lists ##

If you need more help with a filter, please consider asking your question on the DREAM3D Users mailing list:
https://groups.google.com/forum/?hl=en#!forum/dream3d-users

